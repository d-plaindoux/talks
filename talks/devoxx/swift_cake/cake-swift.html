<!doctype html>
<html lang="en">    
  
  <head>
    <meta charset="utf-8">
    
    <title>Swift cooking course: Making a Cake ... Pattern</title>
      
    <meta name="description" content="Cake pattern in Swift 4">
    <meta name="author" content="Didier Plaindoux">
    
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
     
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/mermaid-svg.css">
    <link rel="stylesheet" href="css/theme/devoxx.css" id="theme">
    
    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
      
    <style>
        .close {
            background-color:#556677;
        }
        .img-circle {
            border-radius: 50%;
        }    
        .alert {
            font-size:70% !important;
            position: relative;
            color:white;
            left: 5%;
            width: 90%;
            text-align:middle !important;
            background-color:#994422;
            padding: 10px 0em 10px 0em !important;
            Box-shadow: 5px 5px 5px 0px rgba(0,0,0,0.4); 
        }
        .remark {
            font-size:80% !important;
            position: relative;
            color:white;
            width: 100%;
            text-align:middle !important;
            background-color:#445566;
            padding: 10px 0em 10px 0em !important;
            Box-shadow: 5px 5px 5px 0px rgba(0,0,0,0.4); 
        }
        .remark-service {
            display: block;
            position: relative;
            width: 99%;
            margin: 20px auto;
            text-align: left;
            font-size: 0.55em;
            font-family: monospace;
            line-height: 1.2em;
            word-wrap: break-word;
            background-color:#445533;
            background: linear-gradient(to right, #445533 0%, #55555555 100%);
            box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3); 
        }
        .remark-component {
            display: block;
            position: relative;
            width: 99%;
            margin: 20px auto;
            text-align: left;
            font-size: 0.55em;
            font-family: monospace;
            line-height: 1.2em;
            word-wrap: break-word;
            background-color:#554433;
            background: linear-gradient(to right, #554433 0%, #55555555 100%);
            box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);
        }
        .remark-application {
            display: block;
            position: relative;
            width: 99%;
            margin: 20px auto;
            text-align: left;
            font-size: 0.55em;
            font-family: monospace;
            line-height: 1.2em;
            word-wrap: break-word;
            background-color:#553344;
            background: linear-gradient(to right, #553344 0%, #55555555 100%);
            box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);
        }
        .paradgim-title {
            font-size:70% !important;
            color:white;
            text-align:middle !important;
            background-color:#994422;
            padding: 5px 0em 5px 0em !important;
        }
        .paradigm-what {
            font-size:70% !important;
            color:white;
            text-align:middle !important;
            background-color:#445566;
            padding: 5px 0em 5px 0em !important;
        }
        .title {
            color:black;
            text-align:middle !important;
            background-color:white;
            padding: 1em 0em 1em 0em !important;
            box-shadow: 5px 5px 5px 0px rgba(0,0,0,0.4); 
        }
        .ribbon {
            position:fixed;
            right: 0px; top:0px;
            z-index: 1;
            overflow: hidden;
            width: 150px; height: 150px;
            text-align: right;
        }
        .ribbon span {
            font-size: 12px;
            font-weight: bold;
            color: #FFF;
            text-transform: uppercase;
            text-align: center;
            line-height: 20px;
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
            width: 150px;
            display: block;
            background: #79A70A;
            background: linear-gradient(#F70505 0%, #8F0808 100%);
            box-shadow: 0 3px 10px -5px rgba(0, 0, 0, 1);
            position: absolute;
            top: 34px; right: -32px;
        }
        .map {
            z-index: 1;
            position:absolute;
            right: -2em; top: -0em;
        }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  
  <body>
      
    <div class="reveal">
        <!-- div class="footer"> <span style="right:1em;">TODO</span> </div -->
      
        <div class="slides">
          
    <!-- ####################### -->
          
    <section>
      <h4 style="background-color:white; color:black; width:100%"> Under the great patronage of his majesty the king Mohammed VI </h4>
	  <br/>
	  <h2>Swift cooking course <br> Making a Cake ... Pattern</h2>
	  <br/>
	  <h4>D. Plaindoux | Devoxx Morocco</h4>
	</section>

    <!-- ####################### -->
          
    <section>
	  <h3> Dependency injection with Swift </h3>
      <ul>
        <li> Calling a constructor and/or a setter </li>  
        <li> Container with registration capabilities </li>
      </ul>
      <br>
      <p class="alert fragment"> Classical and "agnostic" approach ... </p>
	</section>

    <!-- ####################### -->
          
    <section>
	  <h3> Dependency injection alternative? </h3>
      <p class="fragment"> Specific design pattern applied <br> using the Swift language expressivness </p>
	</section>

    <!-- ####################### -->
          
    <section>
        <p><img style="vertical-align: middle;" class="plain img-circle" width="12%" src="images/photo.jpg">	  
        &nbsp; <a style="font-size:45px" href="http://twitter.com/dplaindoux">@dplaindoux</a></p>
        <br>
        <p>type MySelf = <b>Freelance</b> &amp; <b>ComputerScientist</b></p>
    </section>
          
    <!-- ####################### -->
          
	<section> 
      <h1> &#x1F36F; </h1>
      <h3> The ingredients </h3>
	</section>	
	
    <!-- ####################### -->
          
	<section> 
	  <img class="plain" width="15%" src="images/swift.png">	  
	  <h3> Quick language overview </h3>    
	</section>	
	
    <!-- ####################### -->
          
	<section>
	  <h3> Objet-Oriented Programming Language </h3>
        
        <center>
            <table width="80%">
            <tr>
            <td width="25%"></td>
            <td align="center" class="fragment" >
                <div class="paradigm-title"> Class </div>
                <div class="paradigm-what"> OO programming </div>
            </td>
            <td width="25%"></td>
            </tr>
            </table>
            <table width="80%">
            <tr>
            <td width="50%" align="center" class="fragment" >
                <div class="paradigm-title"> Structure </div>
                <div class="paradigm-what"> OO &amp; Immutability </div>
            </td>
            <td></td>
            <td width="50%" align="center" class="fragment" >
                <div class="paradigm-title"> Enumeration </div>
                <div class="paradigm-what"> OO &amp; Patterns </div>
            </td>
            </tr>
            </table>
            <table width="80%">
            <tr>
            <td width="25%"></td>
            <td align="center" class="fragment" >
                <div class="paradigm-title"> Protocol </div>
                <div class="paradigm-what"> Specification </div>
            </td>
            <td width="25%"></td>
            </tr>
            </table>
        </center>

	</section>
	
    <!-- ####################### -->
          
    <section>
	  <h3> Protocol </h3>
	  
	  <ul>
	    <li type="square"> Specification: methods, values ... </li>
	    <li type="square" class="fragment"> Extensions </li>
	  </ul>

	</section>

    <!-- ####################### -->
          
	<section>
	  <h3> Protocol specification </h3>
	  
	    <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
protocol User {
  var name : String { get }                     // Variable Specification
}        

<span class="fragment">protocol UserRepository {
  func users() -> [User]                        // Methods specification
  func search(byName name:String) -> User?      // Returns an optional !
}</span>
        </code></pre>	  

	</section>

    <!-- ####################### -->
          
	<section>
	  <h3> Protocol extension </h3>	 
	  
	  <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
extension UserRepository {
  func search(byName name:String) -> User? {
     return self.users()<span class="fragment">.filter{ $0.name == name }</span><span class="fragment">.first</span> // self &equiv; Java this 
  }
}
	  </code></pre>	  

	  <div class="fragment" style="font-size:70%">
	    Looks like "<tt>default</tt>" methods in Java 8+ interfaces
	  </div>
      
    </section>

    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol and inheritance </h3>
        
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift"><img style="vertical-align: middle;" class="map plain" width="20%"  src="images/contact.png">protocol Contact {
  func send(message: String);
}

<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="20%"  src="images/contact-user.png">protocol User : Contact {
  var name: String { get }
}</span>

<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="20%"  src="images/contact-user-extension.png">extension User {
  func send(message: String) { ... }
}</span>
    </code></pre>	  
        
        <p class="fragment">
        A priori ...
        </p>    

	</section>		

    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol extension and ... inheritance ? </h3>
        
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">protocol Contact {
  func send(message: String);
}        
        
<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="20%"  src="images/contact-extension.png">extension User : Contact {
  func send(message: String) { ... }
}</span><span class="fragment"><img style="vertical-align: middle;" class="map plain" width="20%"  src="images/contact-extension-rejected.png"></span>

	  </code></pre>	  
  
        <p class="alert fragment">
            Extension of protocol User cannot have an inheritance clause
        </p>    
      
	</section>		

          <!-- ####################### -->
          
 	<section> 
	  <h3> extension and inheritance </h3>
                
      <p> Only available for Class, Struct and Enum </p>          

        <h3> &#x1F633; </h3>

    </section>		
          
    <!-- ####################### -->
          
	<section> 
	   <h3> The <b>Self</b> type </h3>
        
       <p> "Bounded Polymorphism for Extensible Objects" </p>
	</section>

    <!-- ####################### -->
          
	<section> 
	  <h3> <span style="text-transform: lowercase;">self</span> : <span style="text-transform: capitalize;">Self</span> </h3>

	  <pre><code style="font-size:80%" data-trim data-noescape class="swift">
class Counter {
  var value:Int

  init(_ value:Int = 0) {
    self.value = value
  }

  <span class="fragment">func increment() -> Self {
    self.value += 1
    <span class="fragment">return self // Mutable &#x1F631;</span>
  }</span>
}
	  </code></pre>	  

    <div class="remark fragment" style="font-size:70%">
        Self is the type of the current instance i.e. self ...
    </div>

	</section>

    <!-- ####################### -->
          
	<section> 
	  <h3> a new ... <span style="text-transform: capitalize;">Self</span> </h3>

	  <pre><code style="font-size:80%" data-trim data-noescape class="swift">
class Counter {
  let value:Int

  <span class="fragment">func increment() -> Self {
    return <span class="fragment"><span class="fragment">type(of:self).</span>init</span>(self.value + 1) <span class="fragment">// Immutable &#x1F60E;</span>
  }</span>

  <span class="fragment"><span class="fragment">required</span> init(_ value:Int = 0) {
    self.value = value
  }</span>
}
	  </code></pre>	  

    <div class="remark fragment" style="font-size:70%">
        &#x1F60F; &nbsp; Looks like Perl 5+ object creation
    </div>

	</section>
	
    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol strikes back </h3>
        
        <p> Capability to constraint <tt>Self</tt> type </p>
        <p class="fragment"> Inheritance vs. Composition </p> 
	</section>		
          
    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol implementation and Self constraints </h3>
        
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
protocol Contact {
  func send(message: String);
}        
        
<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="40%"  src="images/user-extension.png">extension User where Self:Contact {
  func send(message: String) { 
    print("Say \(message) to \(name)") 
  }
}</span>
	  </code></pre>	  
        
      <p class="remark fragment"> send defined for a User when composed with a Contact </p>
  
	</section>		

    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol usage and Self constraints </h3>
        
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
protocol Contact {
  func send(message: String);
}        
        
<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="40%"  src="images/contact-extension-accepted.png">extension Contact where Self:User {
  func send(message: String) { 
    print("Say \(message) to \(name)") 
  }
}</span>
	  </code></pre>	  
        
      <p class="remark fragment"> send defined for a Contact when composed with a User </p>
  
	</section>	
          
    <!-- ####################### -->
          
 	<section> 
	  <h3> Protocol and mutual composition </h3>
        
      <p> Mutual Self constraints is allowed <br> when mutual inheritance is not possible! </p>
  
	</section>		

    <!-- ####################### -->
          
	<section> 
	  <h1> &#x2697; </h1>    
      <h3> The Chemistry </h3>
	</section>	
          
    <!-- ####################### -->
          
 	<section> 
      <img class="plain" width="30%" src="images/Scala.png">	  
	  <h3> "Scalable Component Abstractions" </h3>       
    
       <p> Martin Odersky &amp; Matthias Zenger </p>
	</section>		         

    <!-- ####################### -->
          
    <section>
       <h3> Principle #1: Abstract type member </h3>  
        <p> "Abstract type members provide a flexible way to abstract over concrete types of components." </p>
    </section>
          
    <!-- ####################### -->
          
    <section>
       <h3> Notions of Abstraction </h3>  
        
        <table width="100%">
        <tr>
            <td width="50%" align="center"> <h4>Parameterization</h4> </td>
            <td width="50%" align="center"> <h4>Abstract Members</h4>
                <ul>
                    <li type="none" class="fragment"> Method </li>
                    <li type="none" class="fragment"> Variable</li>
                    <li type="none" class="fragment"> Type </li>
                    <li type="none" class="fragment"> Constructor </li>
                </ul>
            </td>
        </tr>
        </table>
        
    </section>

    <!-- ####################### -->

    <section>
       <h3> Principle #2: Explicit self type </h3>        
    
        <p> "Self type annotations allow one to attach a programmer-defined type to self" </p>
    </section>

    <!-- ####################### -->
          
    <section>
       <h3> Principle #3: Modular mixin composition </h3>
        
        <p> "Modular mixin composition provides a flexible way to compose components and component types" </p>
    </section>

    <!-- ####################### -->
          
    <section>
       <h3> Scalable Component Abstractions &amp; Swift </h3>
       <h4> User Repository design illustrated </h4>    
    </section>    

    <!-- ####################### -->
                    
    <section>
       <h3> Specific Protocol </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
struct User : Equatable {
    let name: String

    static func == (lhs:User, rhs:User) -> Bool { return lhs.name == rhs.name }
}

<span class="fragment">protocol UserRepository {
    func create(_ user: User) -> Self
    func delete(_ user: User) -> Self
}</span>
        </code></pre>	         
    </section>
                              
    <!-- ####################### -->
          
    <section>
       <h3> Abstract Type Member &amp; Self type </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift w">
protocol InMemoryRepository {
    associatedtype Element

    <span class="fragment">var elements : [Element] { get }</span>

    <span class="fragment">func create(_ e: Element) -> Self
    func delete(_ e: Element) -> Self</span>

    <span class="fragment">init(_ elements:[Element]) // Constructor specification in Protocols &#x1F60F; </span>
}
	  </code></pre>	         

    </section>

    <!-- ####################### -->
          
    <section>
       <h3> Abstract type member &amp; upper bound </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
extension InMemoryRepository {
    func create(_ e: Element) -> Self {
        return <span class="fragment">type(of:self).init</span>(self.elements + [e])
    }
}

<span class="fragment">extension InMemoryRepository where Element:Equatable {
    func delete(_ e: Element) -> Self {
    	return <span class="fragment">type(of:self).init</span>(self.elements.filter{ $0 != e })
    }
}</span>
</code></pre>	         
    </section>

    <!-- ####################### -->
          
    <section>
       <h3> Abstract type member &amp; upper bound </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
extension InMemoryRepository {
    func create(_ e: Element) -> Self {
        return ...
    }
}

extension InMemoryRepository when Element:Equatable {
    func delete(_ e: Element) -> Self {
    	return ...
    }
}<img style="vertical-align: middle;" class="map plain" width="40%"  src="images/InMemory.png">
        </code></pre>	         
    </section>

    <!-- ####################### -->
                    
    <section>
       <h3> Specific Protocol &amp; Self Type constraint </h3>
       
        <pre><code style="font-size:80%"  data-noescape class="swift">
extension UserRepository 
    where Self:InMemoryRepository 
{
<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="60%"  src="images/user-repository.png"></span>
    <span class="fragment">typealias Element = User<img style="vertical-align: middle;" class="map plain" width="60%"  src="images/user-repository-element.png"></span>
    
}

<span class="fragment"><img style="vertical-align: middle;" class="map plain" width="60%"  src="images/user-repository-extension.png"></span><span class="fragment"><img style="vertical-align: middle;" class="map plain" width="60%"  src="images/user-repository-extension-full.png"></span></code></pre>
    </section>
                       
    <!-- ####################### -->
          
    <section>
       <h3> Structure &amp; Modular mixin composition </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">
struct ConcreteUserRepository : <span class="fragment">UserRepository</span><span class="fragment">, InMemoryRepository</span> {
    <span class="fragment">let elements : [User]</span>

    <span class="fragment">init(_ elements:[User]) { self.elements = elements }</span>
}
<span class="fragment">
let r = ConcreteUserRepository([])<span class="fragment">.create(User(name:"Alice"))</span>
                                  <span class="fragment">.delete(User(name:"Alice"))</span></span>
    </code></pre>	         
    </section>

    <!-- ####################### -->
          
 	<section> 
	  <h1> &#x1F382; </h1>
	  <h3> The Cake pattern </h3>       
    
       <p> Alternative to Dependency Injection? </p>
       <p class="fragment"> Not only! </p>
	</section>		
          
    <!-- ####################### -->
          
 	<section> 
	  <h3> The Cake pattern </h3>       
    
       <p> Design Pattern based on</p>
       <ul>
           <li> Abstrat Type Member </li>
           <li> Modular Mixin Composition </li>
           <li> Explicit Self Type </li>
        </ul>
        
	</section>		
                  
    <!-- ####################### -->
          
 	<section> 
	  <h3> The Cake pattern anatomy </h3>       
        
      <table width="80%">
      <tr class="fragment">
          <td class="paradigm-title" align="center" width="40%"> Service </td> 
          <td width="50%" align="center" class="remark-service"> Domains, API and SPI </td>
          </tr>  
      <tr><td></td><td></td></tr>
      <tr class="fragment">
          <td class="paradigm-title" align="center" width="40%"> Component </td> 
          <td align="center" class="remark-component"> Services wrapper </td>
          </tr>  
      <tr><td></td><td></td></tr>
      <tr class="fragment">
          <td class="paradigm-title" align="center" width="40%"> Application </td> 
          <td align="center" class="remark-application"> Components Assembly </td>
          </tr>  
      </table>
        
      <p class="fragment remark"> "Standardized" boilerplate for application design </p>
    
	</section>		          
                  
    <!-- ####################### -->
          
 	<section> 
      <h3> The Cake pattern physiology </h3>
	  <h4> Services definition and implementation </h4>
    </section>
    
    <!-- ####################### -->
          
 	<section> 
	  <h3> Services definition  </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
struct User {
    let name: String
    let password: String
}        

<span class="fragment">protocol UserRepository {
    func find(name: String) -> User?
}</span>

<span class="fragment">protocol UserService {
    func authenticate(name: String, password: String) -> Bool
}</span>
        </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
	  <h3> A Static Repository Service implementation </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
struct StaticUserRepository : UserRepository {
    <span class="fragment">let users = [ User(name:"Alice", password:"Wonderland") ]</span>
    
    <span class="fragment">func find(name: String) -> User? {
        return self.users.filter{ $0.name == name }.first
    }</span>
}
        </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
	  <h3> A Default user Service implementation </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
struct DefaultUserService : UserService {
    <span class="fragment">let userRepository : UserRepository</span>

    <span class="fragment">func authenticate(name: String, password: String) -> Bool {
        return self.userRepository<span class="fragment">.find(name: name)</span>
                                  <span class="fragment">.map{ $0.password == password }</span><span class="fragment"> ?? false</span>
    }</span>
}
        </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
	  <h3> Quick Service overview </h3>
	        
        <img style="vertical-align: middle;" class="plain" width="60%"  src="images/user-repository-services.png">
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
      <h3> The Cake pattern physiology </h3>
	  <h4> Components definition </h4>
    </section>
    
    <!-- ####################### -->
          
 	<section> 
	  <h3> User Repository component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-component">
protocol UserRepositoryComponent {
    <span class="fragment">static var userRepository : UserRepository { get }</span>
    <span class="fragment">static func createUserRepository() -> UserRepository</span>
}

<span class="fragment">extension UserRepositoryComponent {
    <span class="fragment">static var userRepository : UserRepository {
        return self.createUserRepository()
    }</span>
}</span>
        </code></pre>	
        
        <p class="remark fragment"> Simple service wrapper with abstract creator </p>
        
    </section>		        

    <!-- ####################### -->

 	<section> 
	  <h3> User Service component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-component">
protocol UserServiceComponent {
    <span class="fragment">static var userService : UserService { get }</span>
    <span class="fragment">static func createUserService() -> UserService</span>
}

<span class="fragment">extension UserServiceComponent {
    <span class="fragment">static var userService : UserService {
        return self.createUserService()
    }</span>
}</span>
    </code></pre>	
        
    <p class="remark fragment"> Same wrapper ! Not real DRY </p>
 
    </section>		        
            
    <!-- ####################### -->
          
 	<section> 
	  <h3> Quick Basic Components overview </h3>
	        
        <img style="vertical-align: middle;" class="plain" width="70%"  src="images/components.png">
          
    </section>		          

    <!-- ####################### -->

 	<section> 
	  <h3> Static Repository Component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-component">
protocol StaticUserRepositoryComponent : UserRepositoryComponent {}

<span class="fragment">extension StaticUserRepositoryComponent {
    <span class="fragment">static func createUserRepository() -> UserRepository {
        return StaticUserRepository()
    }</span>
}</span>
    </code></pre>	
        
    </section>		        

    <!-- ####################### -->

 	<section> 
	  <h3> Default User Service Component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-component">
protocol DefaultUserServiceComponent : UserServiceComponent {}

<span class="fragment">extension DefaultUserServiceComponent where Self:UserRepositoryComponent {
    <span class="fragment">static func createUserService() -> UserService {
        return DefaultUserService(<span class="fragment">userRepository: self.userRepository</span>)
    }</span>
}</span>
    </code></pre>	
        
    <p class="fragment remark"> Self constraint used to retrieve the user repository </p>    
        
    </section>
    <!-- ####################### -->
          
 	<section> 
	  <h3> Quick Components overview </h3>
	        
        <img style="vertical-align: middle;" class="plain" width="70%"  src="images/components.png">
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
	  <h3> Quick Components overview </h3>
	        
        <img style="vertical-align: middle;" class="plain" width="70%"  src="images/components-all.png">
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
      <h3> The Cake pattern physiology </h3>
	  <h4> Application definition </h4>
    </section>
    
    <!-- ####################### -->
          
 	<section> 
	  <h3> Mixing components </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-application">
struct Application: <span class="fragment">StaticUserRepositoryComponent</span>,<span class="fragment">DefaultUserServiceComponent</span> {
    <span class="fragment">// Static variables userRepository and userService
    // implicitely setup via variables initialization</span>
}

<span class="fragment">Application.userService</span><span class="fragment">.authenticate(name:"Alice", password:"Wonderland")</span>
        </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
          
	<section> 
	  <h1> &#x1F4D4; </h1>    
      <h3> Revisiting the Recipe </h3>
	</section>	
          
    <!-- ####################### -->

    <section>
        <h3> Protocol Self constraint </h3>
          
        <p> The Twilight Zone </p>
    </section>
          
    <!-- ####################### -->

    <section>
       <h3> Basic Protocol Definition </h3>
       
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift">          
protocol  A { func a() -> String }
extension A { func a() -> String { return "a" } }
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
protocol  B { func b() -> String }
extension B { func b() -> String { return "b" } }
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
protocol  C { func c() -> String }
extension C { func c() -> String { return "c" } }
        </code></pre>	
    </section>
          
    <!-- ####################### -->

    <section>
       <h3> Self constrained extensions </h3>
       
        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
extension C where Self:A { 
    func c() -> String { return "c with \(a())" }
}
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
extension C where Self:B { 
    func c() -> String { return "c with \(b())" }
}
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
extension C where Self:A&amp;B { 
    func c() -> String { return "c with \(a()) and \(b())" }
}
        </code></pre>	
    </section>
          
    <!-- ####################### -->

    <section>
       <h3> Constraint based compositions </h3>
       
        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
class DefaultC : C { func display() { print(c()) } }
DefaultC().display() // prints "c"
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
class DefaultAC : A, C { func display() { print(c()) } }
DefaultAC().display() // prints "c with a"
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
class DefaultBC : B, C { func display() { print(c()) } }
DefaultBC().display() // prints "c with b"
        </code></pre>	

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift">
class DefaultABC : A, B, C { func display() { print(c()) } }
DefaultABC().display() // prints "c with a and b"
        </code></pre>
    </section>
                    
    <!-- ####################### -->

    <section>
       <h3> Self Constraint and Protocol </h3>
        
        <p> Constraint based programming style i.e.<br>
        behaviors aggregation driven by types composition </p>

    </section>    
          
    <!-- ####################### -->
                    
    <section>
        <h3> Revisiting the Cake Pattern </h3>
        <h4> Mimic Spring "<b>Autowired</b>" Annotation </h4>
    </section>
          
    <!-- ####################### -->
          
 	<section> 
	  <h3> User Repository component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-component">
protocol Autowired {}

<span class="fragment">extension UserRepositoryComponent where Self:Autowired {
    static var userRepository : UserRepository {
        return self.createUserRepository()
    }
}</span>

<span class="fragment">extension UserServiceComponent where Self:Autowired {
    static var userService : UserService {
        return self.createUserService()
    }
}</span>
    </code></pre>	
        
    </section>		
             
    <!-- ####################### -->
          
 	<section> 
	  <h3> Mixing components </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-application">
struct Application: StaticUserRepositoryComponent,DefaultUserServiceComponent {
    <span class="fragment">static let userRepository = Application.createUserRepository()
    static let userService    = Application.createUserService()</span>
}
        </code></pre>	         

        <pre class="fragment"><code style="font-size:80%"  data-trim data-noescape class="swift remark-application">
struct Application: StaticUserRepositoryComponent,DefaultUserServiceComponent,
                    Autowired {
    // Static variables implicitly linked
}
        </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
                    
    <section>
	  <h3> Protocol Oriented programming </h3>	 
        
        <p> Programming style </p>
    
        <ul class="fragment">
            <li> Protocol Based Design </li>
            <li> Modular Mixin Composition </li>
        </ul>

    </section>
          
    <!-- ####################### -->
                    
    <section>
        <h3> Protocol Oriented programming philosophy </h4>	 
        
      <p> "Replace a class hierarchy with <br> a protocol-oriented solution" </p>
    </section>

    <!-- ####################### -->
                    
    <section>
        <h3> Revisiting the Cake Pattern </h3>
        <h4> Protocol Oriented Programming applied </h4>
    </section>

    <!-- ####################### -->
          
 	<section> 
	  <h3> A Static Repository Service prototype </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
protocol StaticUserRepository : UserRepository {}

<span class="fragment">extension StaticUserRepository {
    var users : [User] {
        return [ User(name: "Alice", password: "Wonderland") ]
    }
    
    func find(name: String ) -> User? {
        return self.users.filter{ $0.name == name }.first
    }
}</span>
    </code></pre>	         
          
    </section>		          

    <!-- ####################### -->
          
 	<section> 
	  <h3> A Default user Service protocol </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
protocol DefaultUserService : UserService {
    var userRepository : UserRepository { get }
}

<span class="fragment">extension DefaultUserService {
    func authenticate(name: String, password: String) -> Bool {
        return userRepository.find(name:name)
                             .map{ $0.password == password }
                             ?? false
    }
}</span>
        </code></pre>	         
          
    </section>	
          
    <!-- ####################### -->

 	<section> 
	  <h3> Static Repository Component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
struct StaticUserRepositoryStruct : StaticUserRepository {}

<span class="fragment">protocol StaticUserRepositoryComponent : UserRepositoryComponent {}

extension StaticUserRepositoryComponent {
    static func createUserRepository() -> UserRepository {
        return <span class="fragment">StaticUserRepositoryStruct()</span>
    }
}</span>
    </code></pre>	
        
    </section>		        

    <!-- ####################### -->

 	<section> 
	  <h3> Default User Service Component </h3>
	
        <pre><code style="font-size:80%"  data-trim data-noescape class="swift remark-service">
struct DefaultUserServiceStruct : DefaultUserService {
    let userRepository : UserRepository
}

<span class="fragment">protocol DefaultUserServiceComponent : UserServiceComponent {}

extension DefaultUserServiceComponent where Self:UserRepositoryComponent {
    static func createUserService() -> UserService {
        return <span class="fragment">DefaultUserServiceStruct(userRepository: self.userRepository)</span>
    }
}</span>
    </code></pre>	
        
    </section>		        
          
    <!-- ####################### -->
                    
    <section>
        <h3> Abstraction first programming style </h3>	 
        
         <p> "Cake Pattern: The Bakery from the Black Lagoon" <br> Daniel Spiewak </p>
    </section>

    <!-- ####################### -->
          
	<section> 
	  <h3> Some References </h3>
      <ul style="font-size:90% !important;">
          <li> <a> Odersky &amp; Zenger - Scalable component abstractions </a> </li>
          <li> <a> Jonas Boner - Cake Pattern blog post </a> </li>
          <li> <a> D. Spiewak - Cake Pattern conference talk </a> </li>
          <li> <a href="https://www.raywenderlich.com/category/swift"> Protocol Oriented Programming and </a> </li>
          <li type="none"> <a href="https://www.raywenderlich.com/category/swift"> Cake pattern by raywenderlich.com </a> </li>
	  </ul>

	</section>	

    <!-- ####################### -->
          
	<section> 
	  <h3> Questions ? </h3>
	</section>	

    <!-- ####################### -->
          
	<script src="lib/js/head.min.js"></script>
    <script src="plugin/mermaid/mermaid.full.js"></script>  
	<script src="js/reveal.js"></script>
          
    <link rel="stylesheet" href="plugin/css/mermaid.css">
	
	<script>	  
	  // More info https://github.com/hakimel/reveal.js#configuration
	  Reveal.initialize({
          controls: false,
          progress: false,
          history: true,
          center: true,
	      slideNumber: true,
          transition: 'none', // none/fade/slide/convex/concave/zoom

          // More info https://github.com/hakimel/reveal.js#dependencies
          dependencies: [
              { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: 'plugin/zoom-js/zoom.js', async: true },
              { src: 'plugin/notes/notes.js', async: true }
          ]
	  });	  
	</script>
</body>
</html>


